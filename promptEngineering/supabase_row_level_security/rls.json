[
  {
    "table_name": "bet_participations",
    "policy_name": "bet_participations_delete_none",
    "command": "DELETE",
    "using_expression": "false",
    "check_expression": null
  },
  {
    "table_name": "bet_participations",
    "policy_name": "bet_participations_insert_scoped",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((auth.uid() = user_id) AND is_table_member(table_id, auth.uid()) AND (EXISTS ( SELECT 1\n   FROM bet_proposals bp\n  WHERE ((bp.bet_id = bet_participations.bet_id) AND (bp.table_id = bet_participations.table_id) AND (bp.bet_status = 'active'::bet_lifecycle_status) AND is_bet_open(bp.bet_id)))))"
  },
  {
    "table_name": "bet_participations",
    "policy_name": "bet_participations_select_scoped",
    "command": "SELECT",
    "using_expression": "((auth.uid() = user_id) OR (is_table_member(table_id, auth.uid()) AND (NOT is_bet_open(bet_id))))",
    "check_expression": null
  },
  {
    "table_name": "bet_participations",
    "policy_name": "bet_participations_update_scoped",
    "command": "UPDATE",
    "using_expression": "((auth.uid() = user_id) AND is_table_member(table_id, auth.uid()) AND is_bet_open(bet_id))",
    "check_expression": "((auth.uid() = user_id) AND is_table_member(table_id, auth.uid()) AND is_bet_open(bet_id))"
  },
  {
    "table_name": "bet_proposals",
    "policy_name": "Allow members to view bet proposals in their tables",
    "command": "SELECT",
    "using_expression": "(EXISTS ( SELECT 1\n   FROM table_members tm\n  WHERE ((tm.table_id = bet_proposals.table_id) AND (tm.user_id = auth.uid()))))",
    "check_expression": null
  },
  {
    "table_name": "bet_proposals",
    "policy_name": "bet_proposals_delete_none",
    "command": "DELETE",
    "using_expression": "false",
    "check_expression": null
  },
  {
    "table_name": "bet_proposals",
    "policy_name": "bet_proposals_insert_scoped_active_only",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((proposer_user_id = auth.uid()) AND is_user_member_of_table(table_id, auth.uid()) AND (bet_status = 'active'::bet_lifecycle_status) AND (winning_choice IS NULL) AND (resolution_time IS NULL))"
  },
  {
    "table_name": "bet_proposals",
    "policy_name": "bet_proposals_update_none",
    "command": "UPDATE",
    "using_expression": "false",
    "check_expression": "false"
  },
  {
    "table_name": "friend_requests",
    "policy_name": "friend_requests_insert",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((auth.uid() = sender_user_id) AND (sender_user_id <> receiver_user_id))"
  },
  {
    "table_name": "friend_requests",
    "policy_name": "friend_requests_select",
    "command": "SELECT",
    "using_expression": "((auth.uid() = sender_user_id) OR (auth.uid() = receiver_user_id))",
    "check_expression": null
  },
  {
    "table_name": "friend_requests",
    "policy_name": "friend_requests_update",
    "command": "UPDATE",
    "using_expression": "((auth.uid() = sender_user_id) OR (auth.uid() = receiver_user_id))",
    "check_expression": "((auth.uid() = sender_user_id) OR (auth.uid() = receiver_user_id))"
  },
  {
    "table_name": "friends",
    "policy_name": "Allow users to add friends",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((auth.uid() = user_id1) AND (user_id1 <> user_id2))"
  },
  {
    "table_name": "friends",
    "policy_name": "Allow users to read their own friendships",
    "command": "SELECT",
    "using_expression": "((auth.uid() = user_id1) OR (auth.uid() = user_id2))",
    "check_expression": null
  },
  {
    "table_name": "friends",
    "policy_name": "Allow users to remove their own friendships",
    "command": "DELETE",
    "using_expression": "((auth.uid() = user_id1) OR (auth.uid() = user_id2))",
    "check_expression": null
  },
  {
    "table_name": "messages",
    "policy_name": "messages_insert_for_members",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((auth.role() = 'service_role'::text) OR ((auth.uid() IS NOT NULL) AND is_user_member_of_table(table_id, auth.uid())))"
  },
  {
    "table_name": "messages",
    "policy_name": "messages_select_for_members",
    "command": "SELECT",
    "using_expression": "((auth.role() = 'service_role'::text) OR ((auth.uid() IS NOT NULL) AND is_user_member_of_table(table_id, auth.uid())))",
    "check_expression": null
  },
  {
    "table_name": "resolution_history",
    "policy_name": "resolution_history_select_for_members",
    "command": "SELECT",
    "using_expression": "(EXISTS ( SELECT 1\n   FROM bet_proposals bp\n  WHERE ((bp.bet_id = resolution_history.bet_id) AND ((bp.proposer_user_id = auth.uid()) OR (EXISTS ( SELECT 1\n           FROM table_members tm\n          WHERE ((tm.table_id = bp.table_id) AND (tm.user_id = auth.uid()))))))))",
    "check_expression": null
  },
  {
    "table_name": "system_messages",
    "policy_name": "System notifications deletes are restricted",
    "command": "DELETE",
    "using_expression": "false",
    "check_expression": null
  },
  {
    "table_name": "system_messages",
    "policy_name": "System notifications updates are restricted",
    "command": "UPDATE",
    "using_expression": "false",
    "check_expression": null
  },
  {
    "table_name": "system_messages",
    "policy_name": "system_messages_insert_service_role_only",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((current_setting('request.jwt.claim.role'::text, true) = 'service_role'::text) OR (CURRENT_USER = 'postgres'::name))"
  },
  {
    "table_name": "system_messages",
    "policy_name": "system_messages_select",
    "command": "SELECT",
    "using_expression": "true",
    "check_expression": null
  },
  {
    "table_name": "table_members",
    "policy_name": "Allow hosts to add members to their tables",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "is_user_host_of_table(table_id, auth.uid())"
  },
  {
    "table_name": "table_members",
    "policy_name": "Allow hosts to remove members from their tables",
    "command": "DELETE",
    "using_expression": "(EXISTS ( SELECT 1\n   FROM tables pt\n  WHERE ((pt.table_id = table_members.table_id) AND (pt.host_user_id = auth.uid()))))",
    "check_expression": null
  },
  {
    "table_name": "table_members",
    "policy_name": "Allow members to leave tables",
    "command": "DELETE",
    "using_expression": "(user_id = auth.uid())",
    "check_expression": null
  },
  {
    "table_name": "table_members",
    "policy_name": "Allow members to read own membership and hosts to read their ta",
    "command": "SELECT",
    "using_expression": "((user_id = auth.uid()) OR is_user_member_of_table(table_id, auth.uid()))",
    "check_expression": null
  },
  {
    "table_name": "table_members",
    "policy_name": "allow_table_settlement_updates",
    "command": "UPDATE",
    "using_expression": "is_user_host_of_table(table_id, auth.uid())",
    "check_expression": null
  },
  {
    "table_name": "tables",
    "policy_name": "Allow authenticated insert for tables",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "(host_user_id = auth.uid())"
  },
  {
    "table_name": "tables",
    "policy_name": "Allow host to delete their table",
    "command": "DELETE",
    "using_expression": "(host_user_id = auth.uid())",
    "check_expression": null
  },
  {
    "table_name": "tables",
    "policy_name": "Allow host to update their table",
    "command": "UPDATE",
    "using_expression": "(host_user_id = auth.uid())",
    "check_expression": "(host_user_id = auth.uid())"
  },
  {
    "table_name": "tables",
    "policy_name": "Allow members and host to read table details",
    "command": "SELECT",
    "using_expression": "((host_user_id = auth.uid()) OR is_user_member_of_table(table_id, auth.uid()))",
    "check_expression": null
  },
  {
    "table_name": "text_messages",
    "policy_name": "Users can delete their own text messages",
    "command": "DELETE",
    "using_expression": "(auth.uid() = user_id)",
    "check_expression": null
  },
  {
    "table_name": "text_messages",
    "policy_name": "Users can update their own text messages",
    "command": "UPDATE",
    "using_expression": "(auth.uid() = user_id)",
    "check_expression": "(auth.uid() = user_id)"
  },
  {
    "table_name": "text_messages",
    "policy_name": "text_messages_insert_for_members",
    "command": "INSERT",
    "using_expression": null,
    "check_expression": "((auth.uid() = user_id) AND is_user_member_of_table(table_id, auth.uid()))"
  },
  {
    "table_name": "text_messages",
    "policy_name": "text_messages_select_for_members",
    "command": "SELECT",
    "using_expression": "is_user_member_of_table(table_id, auth.uid())",
    "check_expression": null
  },
  {
    "table_name": "users",
    "policy_name": "Allow authenticated read access to usernames",
    "command": "SELECT",
    "using_expression": "(auth.role() = 'authenticated'::text)",
    "check_expression": null
  },
  {
    "table_name": "users",
    "policy_name": "Allow individual read access to own profile",
    "command": "SELECT",
    "using_expression": "(auth.uid() = user_id)",
    "check_expression": null
  },
  {
    "table_name": "users",
    "policy_name": "Allow users to update their own profile",
    "command": "UPDATE",
    "using_expression": "(auth.uid() = user_id)",
    "check_expression": "(auth.uid() = user_id)"
  }
]